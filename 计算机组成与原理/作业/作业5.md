4.3

1).critical paths由最慢的指令决定，即$I$类型指令，最长的需要时间是(相同时间访问的器件选择最长的)：

需要访问指令存储器(400)，访问寄存器(200)，数据多选器进ALU(30)， 使用ALU(120)，访问数据存储器(350), 使用多选器写回寄存器(30)

总时间为 $400 + 200 + 30 + 120 + 350 + 30 = 1130 ps$， 则一个周期为$1130ps$

而若ALU延时增加$300$, 则总时间变成$1130 + 300 = 1430ps$, 一个周期变成$1430ps$

2) $CPU  \ time = Ic × CPI × Tc$

$Ic$ 变成原来的$0.95$,  Tc变成原来的 $\frac{1430}{1130}$， 则加速比是 $0.95×\frac{1430}{1130} = 0.83$

3) 观察图片，发现以下需要的器件：

1个指令存储器(1000)，1个寄存器堆(200)，1个控制单元(500)，一个ALU(100)，一个数据存储器(2000)， 2个加法器(30 × 2)，3个多选器(10 ×3)

花费为 $1000 + 200 + 500 + 100 + 2000 + 60 + 30 = 3890$

ALU成本增加$600$， 则总花费变成$4490$， 价格比为$\frac{4490}{3890} = 1.15$

性价比(花费与性能之比) = $1.15 / 0.83 = 1.39$

所以从性价比的角度看，新的ALU在增加成本的同时，还降低了效率，性价比低 



4.4

1)这一部分同时访问指令存储器($200ps$)和进行加法操作($70ps$)，由于前者所需时间更长，所以时钟周期为$200ps$

2)若是只有无条件跳转，首先需要访问指令寄存器($200ps$)和进行加法操作($70ps$)， 这里完成后进行符号扩展($15ps$)， 得到的结果左移两位($10ps$)， 与加法操作的结果相加($70ps$)， 然后数据选择($20ps$)

则时钟周期为 $200 + 15 + 10 + 70 + 20 = 315ps$

3)若是跳转指令，其最长时间为：首先需要访问指令寄存器($200ps$)，读取寄存器($90ps$)， 然后进行数据选择($20ps$)， 进入ALU($90ps$)， 最后还有一次数据选择($20ps$)

所需时间为 $200 + 90 + 20 + 90 + 20 = 420ps$

时钟周期变为$420ps$



4.7

1)将该指令的第0位到第15位，经过符号扩展单位变成32位：

$00000000000000000000000000010100$

左移两位单元后，右边补0：

$00000000000000000000000001010000$



2)两位 **ALUOp​** 为 $00$(查表4-22)， 6位的指令为  $010100 $(指令5-0位)



3)前6位**opcode​** 为$101011$， 经过查找表得知这条指令是​**sw**指令， 则 $PC = PC + 4$

$PC$首先经过加法器加4， 然后经过 **branch Mux**​和 **jump Mux**后仍然是$PC + 4$



4)由于该指令是**SW**，写入的寄存器是没有用的，**RegDst**为X可以任意，则**WrReg  MUX​**的值可为$2$或$0$(指令20-16位或者15-11位)

**ALU  MUX**​会将最后的16位扩展的结果输出进行地址运算，则输出为$20$

由于**SW**指令的**Write Data**是无用的，则**Mem/ALU MUX**为X(表示无关项)

SW指令只会让 $PC + 4 $， **Branch Mux** 和 **Jump Mux** 都是  $PC + 4 $



5) ALU进行地址运算，一个输入为指令最后16位，是20， 一个是寄存器 $r_3 $(指令25-21位)， 是  $-3 $

  第一个加法器的输入是PC和固定值4， 第二个加法器是 $PC + 4 $ 和 $ 20 * 4 $(最后16位符号扩展后左移两位得到)



6)读入寄存器1是指令25-21，对应的值是 $3(00011) $

   读入寄存器2是指令20-16，对应的是 $2(00010) $

   写寄存器的值任意，可为指令20-16或者15-11, 对应的值为 $2(00010) $或者 $0(00000) $

   写入数据为 $X $(表示一个无关项)

   RegWrite查找表4-2可知是 $0 $(表示不写入数据)





4.8

1) 流水线周期为最长阶段，为 $350ps $, 非流水线为各阶段和，为 $1250ps $

2) $lw $指令在流水线必须得经过五个阶段，延时为  $350 ×5 = 1750ps $, 非流水线为周期 $1250ps $

3)选择最长的阶段ID进行划分，这时候最长阶段是MEM，周期变成 $300ps $

4)数据存储器在lw和sw指令用到，为 $15\% + 20\% = 35\% $

5) $alu $指令和 $lw $指令用得到写寄存器，为 $45\% + 20\% = 65\% $

6)由题意可知多周期设计的时钟周期和流水线设计一样，为 $350ps $, 而单周期的时钟周期为 $1250ps $

设流水线设计的总执行时间为 $a  $

若是不考虑阻塞和冒险，则流水线平均完成一条指令就是 $350ps $, 非流水线为 $1250ps $, 则非流水线时间为  $1250 / 350a = 3.57a $

对于多周期， $alu $指令需要用到4个周期(不含MEM)， $beq $指令要用到3个周期(没有MEM和WB)，  $sw $指令要用到4个周期(没有WB)， $lw $指令全需要

则平均一条指令需要 $ (45\% + 15\%)× 4 + 20\% × 3 + 20\% × 5 = 4 $个周期

则多周期设计时间为 $4a $